<!DOCTYPE html>
<html>

    <head>
        <title>Insights</title>
        <link rel="stylesheet" href="style.css">
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    </head>

    <body>
        <nav id="nav">
            <ul>
                <li><a href="index.html">Explore</a></li>
                <li><a href="data.html">Quiz</a></li>
                <li><a href="insights.html">Insights</a></li>
                <li><a href="faq-page.html">FAQ</a></li>
                <li><a href="china/china_speeches.csv">China Data</a></li>
                <li><a href="our-team/index.html">About</a></li>
            </ul>
        </nav>

        <h1>China Insights</h1>

        <div class="team-member">
            <h2>Top 10 Entities in Chinese Foreign Ministry Dataset</h2>
            <p>The most frequently mentioned entities across all speeches from 2005-2025:</p>
            <div class="visualization-section">
                <div class="viz-container">
                    <div id="entitiesChart"></div>
                </div>
            </div>
        </div>

        <div class="team-member">
            <h2>Hotspot Keywords Over Time</h2>
            <p>Tracking the frequency of strategically important keywords across Chinese Foreign Ministry speeches from 2005-2023:</p>
            <div class="visualization-section">
                <div class="viz-container">
                    <div id="hotspotsChart"></div>
                </div>
            </div>
        </div>

        <script>
        // Load and parse entities CSV data
        fetch('data/china/entities.csv')
            .then(response => response.text())
            .then(data => {
                // Parse CSV
                const lines = data.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.replace(/"/g, ''));
                
                // Get entities and calculate total counts
                const entities = [];
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(v => v.replace(/"/g, ''));
                    const entity = values[0];
                    
                    // Skip "China", "Chinese", and "Xi Jinping"
                    if (entity === 'China' || entity === 'Chinese' || entity === 'Xi Jinping') {
                        continue;
                    }
                    
                    // Sum all count columns (from count05 onwards)
                    let totalCount = 0;
                    for (let j = 1; j < values.length; j++) {
                        totalCount += parseInt(values[j]) || 0;
                    }
                    
                    entities.push({ name: entity, total: totalCount });
                }
                
                // Sort by total count and get top 10
                const top10 = entities.sort((a, b) => b.total - a.total).slice(0, 10);
                
                // Create Plotly bar chart
                const names = top10.map(e => e.name);
                const counts = top10.map(e => e.total);
                
                const trace = {
                    x: names,
                    y: counts,
                    type: 'bar',
                    marker: { color: '#2d3561' }
                };
                
                const layout = {
                    title: 'Top 10 Most Frequent Entities',
                    xaxis: { 
                        title: 'Entity',
                        tickangle: -45
                    },
                    yaxis: { title: 'Total Frequency Count' },
                    margin: { b: 150, l: 60, r: 40, t: 60 },
                    autosize: true,
                    responsive: true
                };
                
                Plotly.newPlot('entitiesChart', [trace], layout);
            });
        </script>

        <script>
        // Load and parse hotspots CSV data
        fetch('data/china/yearly_keyword_counts.csv')
            .then(response => response.text())
            .then(data => {
                // Parse CSV
                const lines = data.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.replace(/"/g, ''));
                
                // Find the column indices for all keywords
                const yearIdx = headers.indexOf('year');
                const hongKongIdx = headers.indexOf('count_Hong_Kong');
                const taiwanIdx = headers.indexOf('count_Taiwan');
                const ukraineIdx = headers.indexOf('count_Ukraine');
                const tibetIdx = headers.indexOf('count_Tibet');
                const xinjiangIdx = headers.indexOf('count_Xinjiang');
                const southChinaSeaIdx = headers.indexOf('count_South_China_Sea');
                
                // Extract data for each keyword
                const years = [];
                const hongKongCounts = [];
                const taiwanCounts = [];
                const ukraineCounts = [];
                const tibetCounts = [];
                const xinjiangCounts = [];
                const southChinaSeaCounts = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(v => v.replace(/"/g, ''));
                    const year = parseInt(values[yearIdx]);
                    const hk = parseInt(values[hongKongIdx]) || 0;
                    const tw = parseInt(values[taiwanIdx]) || 0;
                    const ua = parseInt(values[ukraineIdx]) || 0;
                    const tb = parseInt(values[tibetIdx]) || 0;
                    const xj = parseInt(values[xinjiangIdx]) || 0;
                    const scs = parseInt(values[southChinaSeaIdx]) || 0;
                    
                    years.push(year);
                    hongKongCounts.push(hk);
                    taiwanCounts.push(tw);
                    ukraineCounts.push(ua);
                    tibetCounts.push(tb);
                    xinjiangCounts.push(xj);
                    southChinaSeaCounts.push(scs);
                }
                
                // Create Plotly line chart with all keywords
                const trace1 = {
                    x: years,
                    y: hongKongCounts,
                    name: 'Hong Kong',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#2d3561', width: 2 }
                };
                
                const trace2 = {
                    x: years,
                    y: taiwanCounts,
                    name: 'Taiwan',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#e74c3c', width: 2 }
                };
                
                const trace3 = {
                    x: years,
                    y: ukraineCounts,
                    name: 'Ukraine',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#3498db', width: 2 }
                };
                
                const trace4 = {
                    x: years,
                    y: tibetCounts,
                    name: 'Tibet',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#f39c12', width: 2 }
                };
                
                const trace5 = {
                    x: years,
                    y: xinjiangCounts,
                    name: 'Xinjiang',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#27ae60', width: 2 }
                };
                
                const trace6 = {
                    x: years,
                    y: southChinaSeaCounts,
                    name: 'South China Sea',
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#9b59b6', width: 2 }
                };
                
                const layout = {
                    title: 'Hotspot Keywords Frequency Over Time (2005-2025)',
                    xaxis: { 
                        title: 'Year',
                        type: 'linear',
                        dtick: 1,
                        tickangle: -45
                    },
                    yaxis: { title: 'Frequency Count' },
                    hovermode: 'x unified',
                    margin: { b: 120, l: 60, r: 40, t: 60 },
                    autosize: true,
                    responsive: true
                };
                
                Plotly.newPlot('hotspotsChart', [trace1, trace2, trace3, trace4, trace5, trace6], layout);
            });
        </script>
        <div class="team-member">
  <h2>Share of Speeches Mentioning Selected Regions</h2>
  <p>Percentage of speeches in each period that mention these regions.</p>
  <div class="visualization-section">
    <div class="viz-container">
      <div id="regionShareChart"></div>
    </div>
  </div>
</div>

<script>
// Load charts.csv, compute percent of speeches mentioning each region per period
fetch('charts.csv')
  .then(r => {
    if (!r.ok) throw new Error('CSV fetch failed: ' + r.status);
    return r.text();
  })
  .then(csv => {
    const splitLine = (line) => line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(s => s.replace(/^"|"$/g, ''));
    const lines = csv.replace(/^\uFEFF/, '').replace(/\r/g,'').trim().split('\n');
    if (lines.length < 2) throw new Error('charts.csv empty or malformed');

    const header = splitLine(lines[0]).map(h => h.trim());
    const periodIdx = header.indexOf('period');
    const keywordIdx = header.indexOf('keyword');
    const mentionedIdx = header.indexOf('mentioned');
    if (periodIdx < 0 || keywordIdx < 0 || mentionedIdx < 0) {
      throw new Error('charts.csv missing expected columns: ' + header.join(','));
    }

    const regions = ['Hong Kong','South China Sea','Taiwan','Tibet','Ukraine','Xinjiang'];
    const periods = ['2005–2009','2010–2014','2015–2019','2020–2024'];

    // Aggregate: period -> { rows: number of rows for that period, counts: {keyword: sum(mentioned)} }
    const keywordsSet = new Set();
    const periodInfo = {};
    for (let i = 1; i < lines.length; i++) {
      const row = lines[i].trim();
      if (!row) continue;
      const cols = splitLine(row);
      const period = cols[periodIdx];
      const keyword = cols[keywordIdx];
      const mentioned = parseInt(cols[mentionedIdx], 10) || 0;
      keywordsSet.add(keyword);
      if (!periodInfo[period]) periodInfo[period] = { rows: 0, counts: {} };
      periodInfo[period].rows += 1;
      periodInfo[period].counts[keyword] = (periodInfo[period].counts[keyword] || 0) + mentioned;
    }

    const numKeywords = Math.max(1, keywordsSet.size);

    const periodColors = {
      '2005–2009': '#ef6b6b',
      '2010–2014': '#7fb33a',
      '2015–2019': '#08a7a1',
      '2020–2024': '#c687ff'
    };

    const traces = [];
    periods.forEach(period => {
      const info = periodInfo[period];
      if (!info) return;
      // total speeches = rows for that period divided by number of keywords (one row per speech-keyword)
      const totalSpeeches = Math.max(1, info.rows / numKeywords);
      const vals = regions.map(r => ((info.counts[r] || 0) / totalSpeeches) * 100);
      traces.push({
        x: regions,
        y: vals,
        name: period,
        type: 'bar',
        marker: { color: periodColors[period] || '#888' }
      });
    });

    console.log('region share summary:', Object.fromEntries(
      Object.entries(periodInfo).map(([p,v]) => [p, { rows: v.rows, counts: v.counts }])
    ));

    const layout = {
      title: 'Share of Speeches Mentioning Selected Regions',
      xaxis: { title: 'Region' },
      yaxis: { title: '% of Speeches', ticksuffix: '%', range: [0, 16] },
      barmode: 'group',
      margin: { b: 120, l: 60, r: 40, t: 60 },
      legend: { orientation: 'v', x: 1.02, xanchor: 'left' },
      autosize: true,
      responsive: true
    };

    Plotly.newPlot('regionShareChart', traces, layout);
  })
  .catch(err => {
    console.error('charts.csv load/parse error:', err);
    const el = document.getElementById('regionShareChart');
    if (el) el.innerHTML = '<div style="color:#f66;padding:18px">Error loading charts.csv — see console for details.</div>';
  });
</script>

<div class="team-member">
            <h2>Where is our data from?</h2>
            <p>Our data was scraped from all speeches delivered by Chinese officials and uploaded to the website of the Ministry of Foreign Affairs of the People's Republic of China. It spans from 2005 to 2024. It has been analyzed with NLTK and SpaCy libraries. The source can be found below.</p>
<p>https://www.fmprc.gov.cn/eng/xw/zyjh/</p>
        </div>

 <p style="text-align: center; margin-top: 50px; padding-top: 30px; border-top: 1px solid #2d3561;">
            <a href="index.html">Back to Home</a>
        </p>